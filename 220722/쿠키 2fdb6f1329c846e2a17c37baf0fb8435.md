# 쿠키

### 쿠키 종류

- **Set-Cookie : 서버에서 클라이언트로 쿠키 전달(응답)**
- **Cookie: 클라이언트가 서버에서 받은 쿠키를 저장하고 HTTP 요청시 서버로 전달**

## 매커니즘 설명

## 쿠키 미사용

**처음 welcome 페이지 접근**

![Untitled](%E1%84%8F%E1%85%AE%E1%84%8F%E1%85%B5%202fdb6f1329c846e2a17c37baf0fb8435/Untitled.png)

- 처음으로 접속하는 사람이 welcome 페이지에 접근하면 서버는 로그인도 안한 사용자가 처음으로 들어온 것.

![Untitled](%E1%84%8F%E1%85%AE%E1%84%8F%E1%85%B5%202fdb6f1329c846e2a17c37baf0fb8435/Untitled%201.png)

- 이제 로그인을 한다고 하면, POST 메시지로 보내고, user 정보, pw등등을 서버로 보내서 로그인 정보를 다 준다 → 로그인 된 html이 나온다

![Untitled](%E1%84%8F%E1%85%AE%E1%84%8F%E1%85%B5%202fdb6f1329c846e2a17c37baf0fb8435/Untitled%202.png)

- 로그인 이후에도 welcome 페이지 접근시 서버는 똑같이 “안녕하세요 손님” 메시지를 응답으로 보낸다.
- 서버의 입장에서 /welcome만 오는데 회원인지 아닌지 모르는거니까!

## Stateless

- HTTP는 무상태(Stateless) 프로토콜이다.
- **클라이언트와 서버가 요청과 응답을 주고 받으면 연결이 끊어진다.**
- **클라이언트가 다시 요청하면 서버는 이전 요청을 기억하지 못한다.**
- **클라이언트와 서버는 서로 상태를 유지하지 않는다.**

## 대안이 없을까? → 모든 요청에 사용자 정보를 포함시킨다!

![Untitled](%E1%84%8F%E1%85%AE%E1%84%8F%E1%85%B5%202fdb6f1329c846e2a17c37baf0fb8435/Untitled%203.png)

### But, 심각한 문제 → 개발도 힘들고, 보안상 문제, 메모리 문제 등등

## 대안 : 쿠키

![Untitled](%E1%84%8F%E1%85%AE%E1%84%8F%E1%85%B5%202fdb6f1329c846e2a17c37baf0fb8435/Untitled%204.png)

서버에서 `user=홍길동` 에대한 내용을 Set-Cookie 라는 곳에 넣는다.

→ 이를 웹 브라우저 내에 존재하는 쿠키 저장소에 저장한다.

![Untitled](%E1%84%8F%E1%85%AE%E1%84%8F%E1%85%B5%202fdb6f1329c846e2a17c37baf0fb8435/Untitled%205.png)

로그인 이후에 welcome 페이지에 접근한다면
**웹브라우저는 서버에 요청을 보내기 전에 쿠키 저장소를 무조건 뒤진다. 쿠키값을 꺼내서 Cookie: user=홍길동 추가하고, 서버에 보낸다.**

**이제, 모든 요청에 쿠키 정보가 자동으로 포함된다.**

**하지만, 모든 요청에 보내면 보안 등의 문제가 생기겠죠?**

![Untitled](%E1%84%8F%E1%85%AE%E1%84%8F%E1%85%B5%202fdb6f1329c846e2a17c37baf0fb8435/Untitled%206.png)

**쿠키의 주 사용처는 사용자 로그인 세션에 정말 많이 사용된다!**

**쿠키 정보 중 로그인 세션도 있으니 로그인 세션 ID가 있다면 사용자가 홍길동이구나 하는 것을 알 수 있다!**

**요즘에는 광고 정보를 트래킹 많이 한다 “ 이 웹브라우저 쓰는 사람이 이런이런 제품을 많이 보는구나"** 

**네트워크 트래픽 추가 유발 → 당연히 느려지겠죠? → 최소한의 정보만 사용(id 정도. 사용자가 로그인 했는지 안했는지) 
클라이언트 웹 스토리지를 사용할수도 있음!**

## 생명주기

**→ 만료일(날짜) or 초단위로 설정 가능**

- 세션 쿠키: 만료 날짜를 생략하면 브라우저 종료시까지만 유지
- 영속 쿠키: 만료 날짜를 입력하면 해당 날짜까지 유지

## 도메인

내가 생성한 쿠키가 아무 사이트 들어가도 나오면 문제가 있잖아

**명시 : 도메인을 명시하면 명시한 문서 기준 도메인 + 서브 도메인 포함해서 다 전송**

예) domain=example.org를 지정해서 쿠키 생성

→ example.org는 물론이고 dev.example.org도 쿠키 접근

**생략: 현재 문서 기준 도메인만 적용**

예) example.org에서 쿠키를 생성하고 domain 지정을 생략

- example.org에서만 쿠키 접근
- dev.example.org는 쿠키 미접근

## 경로

**path**

경로를 넣으면 **이 경로를 포함한 하위 경로 페이지만 쿠키 접근**

일반적으로 path=/ 루트로 지정

## 보안

**Secure, HttpOnly, SameSite**

- **Secure**
    - 쿠키는 http, https를 구분하지 않고 전송
    - **Secure를 적용하면 https인 경우에만 전송**
    
- HttpOnly
    - XSS 공격 방지
    - 자바스크립트에서 접근 불가(document.cookie)
    - HTTP 전송에만 사용
- **SameSite**
    - XSRF 공격 방지
    - **요청 도메인과 쿠키에 설정된 도메인이 같은 경우만 쿠키 전송**