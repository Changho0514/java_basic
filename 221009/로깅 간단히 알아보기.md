# 로깅 간단히 알아보기

앞으로 로그를 사용할 것이기 때문에, 이번시간에는 로그에 대해서 간단히 알아보자.

운영 시스템에서는 `System.out.println()` 같은 시스템 콘솔을 사용해서 필요한 정보를 출력하지 않고, **별도의 로깅 라이브러리를 사용해서 로그를 출력**한다.
참고로 로그 관련 라이브러리도 많고, 깊게 들어가면 끝이 없기 때문에, 여기서는 최소한의 사용 방법만 알아본다.

### 로깅 라이브러리

스프링 부트 라이브러리를 사용하면 스프링 부트 로깅 라이브러리( `spring-boot-starter-logging` )가 함께 포함된다.
스프링 부트 로깅 라이브러리는 기본으로 다음 로깅 라이브러리를 사용한다.
`SLF4J - [http://www.slf4j.org](http://www.slf4j.org/)`
`Logback - [http://logback.qos.ch](http://logback.qos.ch/)`
로그 라이브러리는 `Logback, Log4J, Log4J2` 등등 수 많은 라이브러리가 있는데, 그것을 통합해서 인터페이스로 제공하는 것이 바로 `SLF4J` 라이브러리다.
쉽게 이야기해서 `SLF4J`는 인터페이스이고, 그 구현체로 `Logback` 같은 로그 라이브러리를 선택하면 된다.
실무에서는 스프링 부트가 기본으로 제공하는 `Logback`을 대부분 사용한다.

`hello.springmvc.basic.LogTestController`

```java
@RestController
public class LogTestController {
    private final Logger log = LoggerFactory.getLogger(getClass());

    @RequestMapping("/log-test")
    public String logTest() {
        String name = "Spring";

        System.out.println("name = " + name);

        log.info("info log={}", name);

        return "ok";

    }
}
```

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled.png)

`slf4j`의 로거를 사용해야한다.

`getClass()`로 현재 나의 class를 지정해서 파라미터로 넣어준다.

**@Controller** 는 뷰 이름을 반환한다.

**@RestController** 로 하면 문자 그대로를 반환한다. HTTP 메시지 바디에 데이터 그대로 보내버리는 것. RestAPI할 때 Rest와 같다.
RestAPI를 만들 때 핵심적인 역할을 한다. 

**@RestController**
**@Controller** 는 반환 값이 String 이면 뷰 이름으로 인식된다. 그래서 뷰를 찾고 뷰가 랜더링 된다.
**@RestController** 는 반환 값으로 뷰를 찾는 것이 아니라, HTTP 메시지 바디에 바로 입력한다.
따라서 실행 결과로 ok 메세지를 받을 수 있다. **@ResponseBody** 와 관련이 있는데, 뒤에서 더 자세히 설명한다.

실행해서 로그테스트를 누르면,

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled%201.png)

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled%202.png)

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled%203.png)

`System.*out*.println("name = " + name);` 으로 인해 name = Spring이 나왔고, 

`log.info("info log={}", name);` 로 인한 것은 

<aside>
✅ `2022-10-09 16:08:24.515 INFO 11460 --- [nio-8080-exec-2] hello.springmvc.basic.LogTestController : info log=Spring`

</aside>

`nio-8080-exec-2` 는 실행된 쓰레드의 이름이고, 

`ello.springmvc.basic.LogTestController` 는 현재 나의 Controller 명,

`info log=Spring` 이건 메시지

### 로거의 진가는 레벨을 지정할 수 있음에 있다.

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled%204.png)

“이 로그는 debug를 위한거야”

“이 로그는 개발 서버를 위한거야”

“이 로그는 중요한 정보니까 운영시스템에서 봐야해”

“이 로그는 에러가 난거야”

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled%205.png)

trace, debug는 찍히지 않았다.

모든 레벨의 로그를 보고싶다면,

[`application.properties`](http://application.properties) 에 패키지와 그 하위 로그 레벨을 설정해주면 된다.

logging.level.패키지명=trace 

`logging.level.hello.springmvc=trace` 

`trace → debug → info → warn → error` 순으로 심각해진다.

개발서버에서는 debug 정도로 하고, 개인 pc 에서는 trace로 하기도 한다.
실제 서비스 되는 운영서버에는 info정도로. 

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled%206.png)

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled%207.png)

### 올바른 로그 사용법

`log.debug("data="+data)`
로그 출력 레벨을 info로 설정해도 해당 코드에 있는 "data="+data가 실제 실행이 되어 버린다.  결과적으로 문자 더하기 연산이 발생한다.

`log.debug("data={}", data)`
로그 출력 레벨을 info로 설정하면 아무일도 발생하지 않는다. 따라서 앞과 같은 의미없는 연산이 발생하지 않는다.

### @Slf4J

→ 롬복 기능으로, 사용시
`private final Logger log = LoggerFactory.*getLogger*(getClass());`

가 필요없다.

![Untitled](%E1%84%85%E1%85%A9%E1%84%80%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%E1%86%AB%E1%84%92%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%8B%E1%85%A1%E1%84%87%E1%85%A9%E1%84%80%E1%85%B5%20a16c10d45fdf411d961c6536c0c40e7b/Untitled%208.png)

### 로그 사용시 장점

**쓰레드 정보, 클래스 이름 같은 부가 정보를 함께 볼 수 있고, 출력 모양을 조정할 수 있다.**
로그 레벨에 따라 개발 서버에서는 모든 로그를 출력하고, 운영서버에서는 출력하지 않는 등 로그를 상황에 맞게 조절할 수 있다.
시스템 아웃 콘솔에만 출력하는 것이 아니라, 파일이나 네트워크 등, 로그를 별도의 위치에 남길 수 있다.
특히 파일로 남길 때는 일별, 특정 용량에 따라 로그를 분할하는 것도 가능하다.
성능도 일반 System.out보다 좋다. (내부 버퍼링, 멀티 쓰레드 등등) 그래서 실무에서는 꼭 로그를 사용해야 한다.

### 더 공부하기

로그에 대해서 더 자세한 내용은 `slf4j`, `logback`을 검색해보자.
SLF4J - [http://www.slf4j.org](http://www.slf4j.org/)
Logback - [http://logback.qos.ch](http://logback.qos.ch/)
스프링 부트가 제공하는 로그 기능은 다음을 참고하자.
[https://docs.spring.io/spring-boot/docs/current/reference/html/spring-bootfeatures.html#boot-features-logging](https://docs.spring.io/spring-boot/docs/current/reference/html/spring-bootfeatures.html#boot-features-logging)